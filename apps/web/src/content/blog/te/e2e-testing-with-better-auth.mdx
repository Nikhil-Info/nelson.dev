---
title: బెట్టర్ ఆథ్ తో ఎండ్-టు-ఎండ్ టెస్టింగ్
date: '2025-09-17T07:01:11.746Z'
modifiedTime: '2025-09-17T07:01:11.746Z'
summary: బెట్టర్ ఆథ్ తో ఎండ్-టు-ఎండ్ టెస్టింగ్ ఎలా సెటప్ చేయాలో నేర్చుకోండి.
---

## TL;DR

మీరు ఒక చెల్లుబాటు అయ్యే సెషన్ టోకెన్ జనరేట్ చేసి కుకీలుగా స్టోర్ చేయాలి. ఇది మాన్యువల్ లాగిన్ లేకుండా మీ E2E టెస్ట్లను ఆథెంటికేటెడ్ రూట్లకు యాక్సెస్ చేయడానికి అనుమతిస్తుంది. ఈ పద్ధతి క్రెడెన్షియల్స్-బేస్డ్ మరియు OAuth ఆథెంటికేషన్ రెండింటికీ పనిచేస్తుంది.

> GitHub రిపో: [nelsonlaidev/e2e-testing-with-better-auth](https://github.com/nelsonlaidev/e2e-testing-with-better-auth)

## పీఠిక

ఈ గైడ్లో, మేము మా E2E టెస్టింగ్ ఫ్రేమ్వర్క్గా [Playwright](https://playwright.dev/) ఉపయోగిస్తాము, కానీ ఈ కాన్సెప్ట్స్ [Cypress](https://www.cypress.io/) వంటి ఇతర ఫ్రేమ్వర్క్లకు అప్లై చేయవచ్చు.

సరళత కోసం, మేము క్రెడెన్షియల్స్-బేస్డ్ ఆథెంటికేషన్ ఉదాహరణను ఉపయోగిస్తాము. అయితే, ఇదే సూత్రాలు OAuth ప్రొవైడర్లకు వర్తిస్తాయి.

అలాగే, మేము ప్రదర్శన ప్రయోజనాల కోసం SQLite డేటాబేస్ని ఉపయోగిస్తాము. మీ సెటప్కు అనుగుణంగా డేటాబేస్ ఇంటరాక్షన్లను **(ఉదా., టేబుల్ పేర్లు, కాలమ్ రకాలు)** సర్దుబాటు చేయండి.

## సెషన్ టోకెన్ జనరేట్ చేయడం

ఆథెంటికేటెడ్ సెషన్ను సిమ్యులేట్ చేయడానికి, మేము `BETTER_AUTH_SECRET` ఉపయోగించి సంతకం చేయబడిన సెషన్ టోకెన్ను జనరేట్ చేయాలి. ఈ టోకెన్ సెషన్ కుకీలలో ఉపయోగించబడుతుంది.

```ts
import crypto from 'node:crypto'

export const TEST_USER = {
  name: 'టెస్ట్ యూజర్',
  email: 'test@example.com',
  sessionToken: '00000000000000000000000000000000',
  accountId: '000'
}

const signature = crypto
  .createHmac('sha256', process.env.BETTER_AUTH_SECRET!)
  .update(TEST_USER.sessionToken)
  .digest('base64')
const signedValue = `${TEST_USER.sessionToken}.${signature}`
```

## టెస్ట్ డేటాను ఇన్సర్ట్ చేయడం

టెస్ట్ల సమయంలో బహుళ యూజర్లను సృష్టించడం నివారించడానికి మా టెస్ట్ యూజర్ను స్టాటిక్గా ఉంచాలనుకుంటున్నాము. ఇప్పటికే ఉనికిలో లేకపోతే ఒక టెస్ట్ యూజర్, అకౌంట్ మరియు సెషన్ను డేటాబేస్లోకి ఇన్సర్ట్ చేయండి. సరళత కోసం మేము అన్ని ప్రాధమిక కీలకు `0` ని ప్రత్యేక IDగా ఉపయోగిస్తాము.

```ts
import { db } from '@/lib/db'

const TEST_UNIQUE_ID = '0'

const now = new Date().getTime()
const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).getTime() // 7 రోజులు

const transaction = db.transaction(() => {
  db.prepare(
    `
      INSERT OR IGNORE INTO user (
        id, name, email, emailVerified, createdAt, updatedAt
      ) VALUES (?, ?, ?, ?, ?, ?)
    `
  ).run(TEST_UNIQUE_ID, TEST_USER.name, TEST_USER.email, 0, now, now)

  db.prepare(
    `
      INSERT OR IGNORE INTO account (
        id, accountId, providerId, userId, password, createdAt, updatedAt
      ) VALUES (?, ?, ?, ?, ?, ?, ?)
    `
  ).run(TEST_UNIQUE_ID, TEST_USER.accountId, 'credential', TEST_UNIQUE_ID, 'password_hash', now, now)

  db.prepare(
    `
      INSERT INTO session (
        id, token, userId, expiresAt, createdAt, updatedAt
      ) VALUES (?, ?, ?, ?, ?, ?)
      ON CONFLICT(token) DO UPDATE SET
      expiresAt = excluded.expiresAt,
      updatedAt = excluded.updatedAt
    `
  ).run(TEST_UNIQUE_ID, TEST_USER.sessionToken, TEST_UNIQUE_ID, expiresAt, now, now)
})

transaction()
```

## సెషన్ను స్టోర్ చేయడం

టెస్టింగ్ ఫ్రేమ్వర్క్లలో ఉపయోగించడానికి సంతకం చేయబడిన టోకెన్ను JSON ఫైల్లో కుకీగా సేవ్ చేయండి. కుకీ విలువను `encodeURIComponent{:.entity.name.function}` తో ఎన్కోడ్ చేయడం మర్చిపోవద్దు.

```ts
import fs from 'node:fs/promises'

const cookieObject = {
  name: 'better-auth.session_token',
  value: encodeURIComponent(signedValue), // [!code highlight]
  domain: 'localhost',
  path: '/',
  httpOnly: true,
  secure: false,
  sameSite: 'Lax',
  expires: Math.round(expiresAt / 1000)
}

await fs.writeFile('.auth/auth.json', JSON.stringify({ cookies: [cookieObject], origins: [] }, null, 2))
```

## టెస్ట్లలో సెషన్ను ఉపయోగించడం

లాగిన్ అవకుండానే ప్రొటెక్టెడ్ రూట్లకు యాక్సెస్ చేయడానికి మీ E2E టెస్ట్లలో స్టోర్ చేయబడిన సెషన్ను లోడ్ చేయండి. క్రింది ఉదాహరణ Playwrightని ఉపయోగిస్తుంది, కానీ ఇది కుకీ ఇంజెక్షన్ను సపోర్ట్ చేసే ఏదైనా టెస్టింగ్ లైబ్రరీకి (ఉదా., Cypress) అనుగుణంగా మార్చబడుతుంది.

```ts title='playwright.config.ts'
export default defineConfig({
  // ...
  projects: [
    { name: 'setup', testMatch: /global\.setup\.ts/, teardown: 'teardown' }, // [!code highlight]

    { name: 'teardown', testMatch: /global\.teardown\.ts/ }, // [!code highlight]

    {
      name: 'chromium',
      use: {
        ...devices['Desktop Chrome'],
        storageState: '.auth/auth.json' // [!code highlight]
      },
      dependencies: ['setup'] // [!code highlight]
    }
  ]
})
```

## ఉపయోగకరమైన లింకులు

- [Playwright సెటప్ మరియు టీయర్డౌన్](https://playwright.dev/docs/test-global-setup-teardown)
- [Playwright స్టోరేజ్ స్టేట్](https://playwright.dev/docs/auth#reuse-authentication-in-other-scenarios)
- [Cypress హుక్స్](https://docs.cypress.io/app/core-concepts/writing-and-organizing-tests#Hooks)
- [Cypress సెట్ కుకీ](https://docs.cypress.io/api/commands/setcookie)
